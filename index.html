<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Moot Court Generator</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <style>
        :root { --legal-blue: #1a237e; --ui-bg: #f8f9fa; --border-color: #dee2e6; }
        body { margin: 0; display: flex; flex-direction: column; height: 100vh; font-family: 'Segoe UI', system-ui, sans-serif; background: #525659; overflow: hidden; }
        
        header { background: var(--legal-blue); color: white; padding: 10px 25px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.2); z-index: 100; }
        .app-container { display: flex; flex: 1; overflow: hidden; }

        /* SIDEBAR & UNIFORM BUTTONS */
        .sidebar { width: 250px; background: white; border-right: 1px solid var(--border-color); display: flex; flex-direction: column; padding: 15px; }
        .tab-btn { padding: 12px 15px; border: none; background: transparent; text-align: left; cursor: pointer; border-radius: 6px; margin-bottom: 5px; font-weight: 500; color: #495057; font-size: 0.9rem; }
        .tab-btn.active { background: #e8eaf6; color: var(--legal-blue); font-weight: 700; }
        
        .save-load-container { margin-top: auto; padding-top: 20px; border-top: 1px solid #eee; display: flex; flex-direction: column; gap: 10px; align-items: center; }
        .sl-btn { width: 90%; padding: 10px; background: #454545; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.85rem; font-weight: bold; text-align: center; display: block; box-sizing: border-box; }
        .sl-btn:hover { background: #333; }

        /* INPUT PANELS */
        .input-panel { flex: 1; background: white; padding: 30px; overflow-y: auto; border-right: 2px solid #333; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .dynamic-row { display: flex; gap: 8px; margin-bottom: 8px; align-items: center; }
        .remove-btn { background: #ffeaec; color: #d32f2f; border: 1px solid #ffcdd2; border-radius: 4px; padding: 8px; cursor: pointer; font-weight: bold; flex-shrink: 0; }
        .add-btn { background: #f8f9fa; border: 2px dashed #ccc; color: #666; width: 100%; padding: 10px; margin-top: 10px; cursor: pointer; border-radius: 6px; font-weight: 600; }

        /* PREVIEW & PAPER - FIXED OVERFLOW */
        .preview-panel { flex: 1.4; padding: 40px; overflow-y: auto; display: block; background: #525659; }
        .paper { width: 8.5in; min-height: 11in; background: white; padding: 1in; margin: 0 auto 40px auto; box-shadow: 0 0 25px rgba(0,0,0,0.4); font-family: 'Crimson Pro', serif; font-size: 12pt; line-height: 1.5; color: black; box-sizing: border-box; }

        label { display: block; font-weight: 700; font-size: 0.75rem; margin-top: 20px; color: #444; text-transform: uppercase; }
        input, textarea, select { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid var(--border-color); border-radius: 4px; box-sizing: border-box; font-size: 1rem; }

        /* LEGAL TYPESETTING */
        .court-header { text-align: center; font-weight: bold; text-transform: uppercase; margin: 25px 0; }
        .caption-container { display: flex; margin: 20px 0; }
        .party-side { flex: 1; }
        .bracket-side { border-left: 2px solid black; padding-left: 20px; min-width: 180px; font-style: italic; display: flex; align-items: center; }
        .title-box { text-align: center; border-top: 2px solid black; border-bottom: 2px solid black; padding: 15px; margin: 30px 0; font-weight: bold; text-transform: uppercase; }
        .page-break { border-top: 1px dashed #ccc; margin: 40px 0; page-break-before: always; }
        .section-center { text-align: center; font-weight: bold; text-transform: uppercase; margin-bottom: 20px; }
    </style>
</head>
<body>

<header>
    <div class="logo">‚öñÔ∏è Moot Court Brief Generator</div>
    <div id="google-btn-wrapper">
        <div id="g_id_onload" data-client_id="YOUR_ID" data-callback="handleCredentialResponse"></div>
        <div class="g_id_signin" data-type="standard"></div>
    </div>
</header>

<main class="app-container">
    <nav class="sidebar">
        <button class="tab-btn active" onclick="showTab('setup')">1. Initial Setup</button>
        <button class="tab-btn" onclick="showTab('cover')">2. Cover Page</button>
        <button class="tab-btn" onclick="showTab('authorities')">3. Authorities</button>
        <button class="tab-btn" onclick="showTab('questions')">4. Questions</button>
        <button class="tab-btn" onclick="showTab('argument')">5. Argument</button>
        <button class="tab-btn" onclick="showTab('conclusion_tab')">6. Conclusion</button>
        
        <div class="save-load-container">
            <button class="sl-btn" onclick="exportProject()">SAVE PROGRESS</button>
            <label class="sl-btn" style="cursor:pointer;">
                LOAD PROGRESS
                <input type="file" id="importFile" hidden onchange="importProject(event)">
            </label>
        </div>
    </nav>

    <section class="input-panel">
        <div id="setup" class="tab-content active">
            <h2>Initial Setup</h2>
            <label>I am writing for the:</label>
            <select id="briefType" onchange="updatePreview()">
                <option value="Petitioner">Petitioner</option>
                <option value="Respondent">Respondent</option>
                <option value="Amicus Curiae">Amicus Curiae</option>
            </select>
            <label>Court Term:</label>
            <input type="text" id="courtTerm" placeholder="e.g. October Term, 2025" oninput="updatePreview()">
            <label>Law Firm or School Name:</label>
            <input type="text" id="firmName" placeholder="e.g. Lincoln High School" oninput="updatePreview()">
            <label>Student Counsel Names:</label>
            <textarea id="studentNames" rows="3" placeholder="John Doe&#10;Jane Smith" oninput="updatePreview()"></textarea>

            <div id="amicus-interest-box" style="display:none; background:#e8eaf6; padding:15px; margin-top:15px; border-radius:6px;">
                <label>Interest of Amicus Curiae (Bio/Qualifications):</label>
                <textarea id="amicusInterest" rows="4" oninput="updatePreview()"></textarea>
            </div>
        </div>

        <div id="cover" class="tab-content">
            <h2>Cover Page</h2>
            <label>Docket Number:</label>
            <input type="text" id="docketNum" placeholder="No. 24-100" oninput="updatePreview()">
            <label>Petitioners:</label>
            <div id="petitioner-container"></div>
            <button class="add-btn" onclick="addDynamicField('petitioner')">+ Add Petitioner</button>
            <label>Respondents:</label>
            <div id="respondent-container"></div>
            <button class="add-btn" onclick="addDynamicField('respondent')">+ Add Respondent</button>
            <label>On Writ of Certiorari To:</label>
            <input type="text" id="lowerCourt" oninput="updatePreview()">
        </div>

        <div id="authorities" class="tab-content">
            <h2>Table of Authorities</h2>
            <label>Cases:</label>
            <div id="case-container"></div>
            <button class="add-btn" onclick="addDynamicField('case')">+ Add Case Reference</button>
            <label>Statutes / Other:</label>
            <div id="statute-container"></div>
            <button class="add-btn" onclick="addDynamicField('statute')">+ Add Statute</button>
        </div>

        <div id="questions" class="tab-content">
            <h2>Questions Presented</h2>
            <div id="question-container"></div>
            <button class="add-btn" onclick="addDynamicField('question')">+ Add Question</button>
        </div>

        <div id="argument" class="tab-content">
            <h2>Legal Argument</h2>
            <label>Summary of Argument:</label>
            <textarea id="summaryArg" rows="4" oninput="updatePreview()"></textarea>
            <label>Main Argument Body:</label>
            <textarea id="argBody" rows="12" oninput="updatePreview()"></textarea>
        </div>

        <div id="conclusion_tab" class="tab-content">
            <h2>Conclusion</h2>
            <textarea id="conclusionText" rows="6" oninput="updatePreview()"></textarea>
            <button class="export-btn" style="background:var(--legal-blue); color:white; padding:15px; width:100%; border:none; border-radius:6px; margin-top:20px; font-weight:bold; cursor:pointer;" onclick="downloadPDF()">üì• DOWNLOAD PDF</button>
            <button class="export-btn" style="background:#555; color:white; padding:15px; width:100%; border:none; border-radius:6px; margin-top:10px; font-weight:bold; cursor:pointer;" onclick="window.print()">üñ®Ô∏è DIRECT PRINT</button>
        </div>
    </section>

    <section class="preview-panel">
        <div id="print-area" class="paper">
            <div id="preview-render"></div>
        </div>
    </section>
</main>

<script>
    // Initialize with default empty fields
    let appData = {
        petitioners: [""], 
        respondents: [""], 
        questions: [""],
        cases: [""], 
        statutes: [""]
    };

    function toTitleCase(str) {
        if (!str) return "";
        return str.replace(/\w\S*/g, (txt) => txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase());
    }

    function showTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        document.querySelector(`[onclick="showTab('${tabId}')"]`).classList.add('active');
    }

    function addDynamicField(type) {
        appData[type + 's'].push("");
        renderDynamicFields();
        updatePreview();
    }

    function removeDynamicField(type, index) {
        if (appData[type + 's'].length > 1) {
            appData[type + 's'].splice(index, 1);
        } else {
            appData[type + 's'][0] = ""; // Clear instead of remove if it's the last one
        }
        renderDynamicFields();
        updatePreview();
    }

    function handleInputChange(type, index, value) {
        appData[type + 's'][index] = value;
        updatePreview();
    }

    function renderDynamicFields() {
        const types = ['petitioner', 'respondent', 'question', 'case', 'statute'];
        types.forEach(t => {
            const container = document.getElementById(`${t}-container`);
            if(!container) return;
            container.innerHTML = appData[t+'s'].map((val, i) => `
                <div class="dynamic-row">
                    <input type="text" value="${val}" oninput="handleInputChange('${t}', ${i}, this.value)" placeholder="Enter information...">
                    <button class="remove-btn" onclick="removeDynamicField('${t}', ${i})">√ó</button>
                </div>
            `).join('');
        });
    }

    function updatePreview() {
        const get = (id) => document.getElementById(id) ? document.getElementById(id).value : "";
        const bType = get('briefType');
        
        // Show/Hide Amicus box
        if(document.getElementById('amicus-interest-box')) {
            document.getElementById('amicus-interest-box').style.display = (bType === 'Amicus Curiae') ? 'block' : 'none';
        }

        const sortedCases = [...appData.cases].filter(x => x).sort();
        const sortedStats = [...appData.statutes].filter(x => x).sort();

        let html = `
            <div class="docket">${get('docketNum').toUpperCase() || 'No. 24-XXXX'}</div>
            <div class="court-header">In the Supreme Court of the United States</div>
            <div style="text-align:center; font-weight:600;">${get('courtTerm') || '[TERM]'}</div>
            <hr style="border:0; border-top:1px solid black; margin:10px 0;">

            <div class="caption-container">
                <div class="party-side">
                    ${appData.petitioners.map(p => toTitleCase(p) || '<i>[Petitioner]</i>').join(',<br>')},<br>
                    <i>Petitioner${appData.petitioners.length > 1 ? 's' : ''}</i>,<br>
                    <div style="margin:10px 40px">v.</div>
                    ${appData.respondents.map(r => toTitleCase(r) || '<i>[Respondent]</i>').join(',<br>')},<br>
                    <i>Respondent${appData.respondents.length > 1 ? 's' : ''}.</i>
                </div>
                <div class="bracket-side">On Writ of Certiorari to the ${get('lowerCourt') || '[Lower Court]'}</div>
            </div>

            <div class="title-box">BRIEF FOR THE ${bType.toUpperCase()}</div>

            <div style="text-align:center; margin-top:60px;">
                <b>Respectfully Submitted,</b><br>
                ${get('firmName') || '[Firm/School]'}<br>
                <div style="font-size:10pt; margin-top:10px;">${get('studentNames').replace(/\n/g, '<br>')}</div>
            </div>

            <div class="page-break"></div>
            <div class="section-center">TABLE OF AUTHORITIES</div>
            <p><b>Cases:</b></p>
            ${sortedCases.map(c => `<div style="font-style:italic; margin-bottom:5px;">${c}</div>`).join('')}
            <p><b>Statutes:</b></p>
            ${sortedStats.map(s => `<div style="margin-bottom:5px;">${s}</div>`).join('')}

            <div class="page-break"></div>
            <div class="section-center">QUESTIONS PRESENTED</div>
            ${appData.questions.map((q, i) => `<p><b>${i+1}.</b> ${q || '...'}</p>`).join('')}

            ${bType === 'Amicus Curiae' ? `
                <div class="page-break"></div>
                <div class="section-center">INTEREST OF AMICUS CURIAE</div>
                <p style="white-space: pre-wrap;">${get('amicusInterest')}</p>
            ` : ''}

            <div class="page-break"></div>
            <div class="section-center">ARGUMENT</div>
            <p><b>SUMMARY OF ARGUMENT:</b> ${get('summaryArg')}</p>
            <p style="white-space: pre-wrap;">${get('argBody')}</p>

            <div class="page-break"></div>
            <div class="section-center">CONCLUSION</div>
            <p style="white-space: pre-wrap;">${get('conclusionText')}</p>
        `;
        document.getElementById('preview-render').innerHTML = html;
    }

    function downloadPDF() {
        const element = document.getElementById('print-area');
        html2pdf().from(element).set({
            margin: 0.5,
            filename: 'Moot_Court_Brief.pdf',
            html2canvas: { scale: 2 },
            jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
        }).save();
    }

    function exportProject() {
        const textInputs = {};
        document.querySelectorAll('input, textarea, select').forEach(el => { if(el.id) textInputs[el.id] = el.value; });
        const blob = new Blob([JSON.stringify({ text: textInputs, arrays: appData })], {type: "application/json"});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = "moot_court_save.json";
        a.click();
    }

    function importProject(event) {
        const file = event.target.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            const saved = JSON.parse(e.target.result);
            appData = saved.arrays;
            for(let id in saved.text) { if(document.getElementById(id)) document.getElementById(id).value = saved.text[id]; }
            renderDynamicFields();
            updatePreview();
        };
        reader.readAsText(file);
    }

    function handleCredentialResponse(response) { console.log("Login OK"); }

    // Initial render
    window.onload = () => {
        renderDynamicFields();
        updatePreview();
    };
</script>
</body>
</html>
