<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCOTUS Brief Pro | Legal Generator</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <style>
        :root { --legal-blue: #1a237e; --ui-bg: #f8f9fa; --border-color: #dee2e6; }
        
        body { margin: 0; display: flex; flex-direction: column; height: 100vh; font-family: 'Segoe UI', sans-serif; background: #525659; overflow: hidden; }
        header { background: var(--legal-blue); color: white; padding: 10px 25px; display: flex; justify-content: space-between; align-items: center; z-index: 1000; }
        .app-container { display: flex; flex: 1; overflow: hidden; }

        /* SIDEBAR */
        .sidebar { width: 280px; background: white; border-right: 1px solid var(--border-color); display: flex; flex-direction: column; padding: 15px; z-index: 10; overflow-y: auto; }
        .tab-btn { padding: 12px; border: none; background: transparent; text-align: left; cursor: pointer; border-radius: 6px; margin-bottom: 5px; font-weight: 600; color: #444; transition: 0.2s; }
        .tab-btn.active { background: #e8eaf6; color: var(--legal-blue); }
        
        .persistence-zone { margin-top: auto; padding-top: 15px; border-top: 1px solid #eee; display: flex; flex-direction: column; gap: 8px; }
        .action-btn { width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #ccc; cursor: pointer; font-size: 0.8rem; font-weight: bold; }
        .btn-cloud { background: var(--legal-blue); color: white; border: none; display: none; }

        /* INPUT PANEL */
        .input-panel { flex: 1; background: white; padding: 30px; overflow-y: auto; border-right: 2px solid #333; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        label { display: block; font-weight: 700; font-size: 0.7rem; margin-top: 18px; color: #666; text-transform: uppercase; }
        input, textarea, select { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px; font-size: 1rem; box-sizing: border-box; }
        .dynamic-row { display: flex; gap: 8px; margin-bottom: 8px; align-items: center; }

        /* PREVIEW & PAGE NUMBERS */
        .preview-panel { flex: 1.5; padding: 40px; overflow-y: auto; background: #525659; }
        .paper { width: 8.5in; min-height: 11in; background: white; padding: 1in; margin: 0 auto 50px auto; box-shadow: 0 0 30px rgba(0,0,0,0.5); font-family: 'Crimson Pro', serif; font-size: 12pt; line-height: 1.6; color: black; position: relative; }

        /* PRINT SETTINGS */
        @media print {
            body, .app-container, .preview-panel { height: auto !important; overflow: visible !important; display: block !important; background: white !important; }
            header, .sidebar, .input-panel { display: none !important; }
            .paper { box-shadow: none !important; margin: 0 !important; width: 100% !important; padding: 0.75in !important; border: none !important; }
            
            /* Page Numbering Logic */
            @page { margin: 0.75in; }
            .paper::after {
                content: "Page " counter(page);
                position: fixed; bottom: 0.4in; left: 0; right: 0; text-align: center; font-size: 10pt; font-family: 'Crimson Pro', serif;
            }
        }

        /* TYPESETTING */
        .sc-caps { font-variant: small-caps; }
        .court-header { text-align: center; font-weight: bold; font-size: 14pt; text-transform: uppercase; margin: 30px 0; }
        .title-box { text-align: center; border-top: 1.5pt solid black; border-bottom: 1.5pt solid black; padding: 20px 10px; margin: 40px 0; font-weight: bold; text-transform: uppercase; }
        .section-header { text-align: center; font-weight: bold; text-transform: uppercase; margin: 35px 0 20px 0; }
        .tos-footer { margin-top: 50px; padding: 20px; border-top: 1px solid #eee; text-align: center; font-size: 0.8rem; color: #888; }
    </style>
</head>
<body>

<header>
    <div style="font-weight:bold;">‚öñÔ∏è SCOTUS Brief Generator Pro</div>
    <div id="google-btn-wrapper">
        <div id="g_id_onload" data-client_id="129113401099-ihpv7tunjjfeuovepgphcfibf4nqj25g.apps.googleusercontent.com" data-callback="onSignIn"></div>
        <div class="g_id_signin" data-type="standard"></div>
    </div>
</header>

<main class="app-container">
    <nav class="sidebar">
        <div id="auth-status" style="font-size: 0.75rem; color: #666; margin-bottom: 15px;">Sign in to save multiple projects.</div>
        
        <div id="project-selector-zone" style="display:none; margin-bottom:20px;">
            <label style="margin-top:0;">Load Saved Project:</label>
            <select id="projectList" onchange="loadSelectedProject()"></select>
        </div>

        <button class="tab-btn active" onclick="switchTab('setup')">1. Initial Setup</button>
        <button class="tab-btn" onclick="switchTab('cover')">2. Cover Page</button>
        <button class="tab-btn" onclick="switchTab('authorities')">3. Authorities</button>
        <button class="tab-btn" onclick="switchTab('questions')">4. Questions</button>
        <button class="tab-btn" onclick="switchTab('argument')">5. Argument</button>
        <button class="tab-btn" onclick="switchTab('finalize')">6. Finalize & Print</button>
        
        <div class="persistence-zone">
            <button class="action-btn btn-cloud" id="cloudBtn" onclick="dbSave()">‚òÅÔ∏è Save to My Account</button>
            <button class="action-btn" onclick="localExport()">üíæ Export .JSON File</button>
            <label class="action-btn" style="text-align:center; display:block; background:#eee; cursor:pointer;">
                üìÇ Import .JSON File
                <input type="file" id="importFile" hidden onchange="localImport(event)">
            </label>
        </div>
    </nav>

    <section class="input-panel">
        <div id="setup" class="tab-content active">
            <h2>Project Setup</h2>
            <label>Project Title (For Saving):</label>
            <input type="text" id="projectTitle" placeholder="e.g. Smith v. Jones Final" oninput="refresh()">
            
            <label>Writing for:</label>
            <select id="briefType" onchange="refresh()">
                <option value="Petitioner">Brief for Petitioner</option>
                <option value="Respondent">Brief for Respondent</option>
                <option value="Amicus Curiae">Brief for Amicus Curiae</option>
            </select>
            <label>Court Term:</label>
            <input type="text" id="courtTerm" placeholder="October Term, 2025" oninput="refresh()">
            <label>School or Law Firm:</label>
            <input type="text" id="firmName" oninput="refresh()">
            <label>Student Counsel Names:</label>
            <textarea id="studentNames" rows="3" oninput="refresh()"></textarea>

            <div id="amicus-box" style="display:none; margin-top:15px; background:#f0f4f8; padding:15px; border-radius:8px;">
                <label>Interest of Amicus Curiae:</label>
                <textarea id="amicusInterest" rows="4" oninput="refresh()"></textarea>
            </div>
        </div>

        <div id="cover" class="tab-content">
            <h2>Cover Details</h2>
            <label>Docket Number:</label>
            <input type="text" id="docketNum" placeholder="No. 26-1234" oninput="refresh()">
            <label>Petitioners:</label>
            <div id="petitioner-inputs"></div>
            <button onclick="addDynamic('petitioner')">+ Add</button>
            <label>Respondents:</label>
            <div id="respondent-inputs"></div>
            <button onclick="addDynamic('respondent')">+ Add</button>
            <label>Lower Court:</label>
            <input type="text" id="lowerCourt" oninput="refresh()">
        </div>

        <div id="authorities" class="tab-content">
            <h2>Authorities</h2>
            <label>Cases:</label>
            <div id="case-inputs"></div>
            <button onclick="addDynamic('case')">+ Add Case</button>
            <label>Statutes:</label>
            <div id="statute-inputs"></div>
            <button onclick="addDynamic('statute')">+ Add Statute</button>
        </div>

        <div id="questions" class="tab-content">
            <h2>Questions Presented</h2>
            <div id="question-inputs"></div>
            <button onclick="addDynamic('question')">+ Add Question</button>
        </div>

        <div id="argument" class="tab-content">
            <h2>Argument</h2>
            <label>Summary:</label>
            <textarea id="summaryArg" rows="4" oninput="refresh()"></textarea>
            <label>Full Argument Body:</label>
            <textarea id="argBody" rows="12" oninput="refresh()"></textarea>
        </div>

        <div id="finalize" class="tab-content">
            <h2>Final Step</h2>
            <label>Conclusion Text:</label>
            <textarea id="conclusionText" rows="5" oninput="refresh()"></textarea>
            <div style="margin-top:30px; display:flex; flex-direction:column; gap:10px;">
                <button class="action-btn" style="background:var(--legal-blue); color:white; height:50px;" onclick="downloadPDF()">üì• DOWNLOAD PDF BRIEF</button>
                <button class="action-btn" style="background:#333; color:white; height:50px;" onclick="window.print()">üñ®Ô∏è DIRECT PRINT (ALL PAGES)</button>
            </div>
        </div>

        <footer class="tos-footer">
            <p>By using this tool, you agree to our <a href="terms.html" target="_blank">Terms of Service</a>.</p>
            <p>¬© 2026 Moot Court Generator</p>
        </footer>
    </section>

    <section class="preview-panel">
        <div id="print-area" class="paper">
            <div id="render-target"></div>
        </div>
    </section>
</main>

<script>
    let data = { petitioners: [""], respondents: [""], questions: [""], cases: [""], statutes: [""] };
    let userKey = null;

    window.onload = () => { renderInputFields(); refresh(); };

    function switchTab(id) {
        document.querySelectorAll('.tab-content, .tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelector(`[onclick="switchTab('${id}')"]`).classList.add('active');
    }

    function addDynamic(type) {
        data[type + 's'].push("");
        renderInputFields(); refresh();
    }

    function removeDynamic(type, idx) {
        if(data[type + 's'].length > 1) data[type + 's'].splice(idx, 1);
        else data[type + 's'][0] = "";
        renderInputFields(); refresh();
    }

    function renderInputFields() {
        ['petitioner', 'respondent', 'question', 'case', 'statute'].forEach(t => {
            const container = document.getElementById(`${t}-inputs`);
            if(!container) return;
            container.innerHTML = data[t+'s'].map((val, i) => `
                <div class="dynamic-row">
                    <input type="text" value="${val}" oninput="data['${t}s'][${i}]=this.value; refresh()" placeholder="...">
                    <button style="border:none; background:none; cursor:pointer;" onclick="removeDynamic('${t}', ${i})">‚ùå</button>
                </div>
            `).join('');
        });
    }

    function refresh() {
        const get = (id) => document.getElementById(id)?.value || "";
        const bType = get('briefType');
        document.getElementById('amicus-box').style.display = (bType === 'Amicus Curiae') ? 'block' : 'none';

        let html = `
            <div class="docket">${get('docketNum').toUpperCase() || 'NO. 00-000'}</div>
            <div class="court-header">In the <span class="sc-caps">Supreme Court of the United States</span></div>
            <div style="text-align:center; font-weight:bold;">${get('courtTerm').toUpperCase()}</div>
            <hr style="border:0; border-top:1.5pt solid black; margin:10px 0;">

            <div style="display:flex; margin:20px 0;">
                <div style="flex:1;">
                    ${data.petitioners.map(p => p.toUpperCase() || 'PETITIONER').join(',<br>')},<br>
                    <i>Petitioner${data.petitioners.length > 1 ? 's' : ''}</i>,<br>
                    <div style="margin:15px 40px;">v.</div>
                    ${data.respondents.map(r => r.toUpperCase() || 'RESPONDENT').join(',<br>')},<br>
                    <i>Respondent${data.respondents.length > 1 ? 's' : ''}.</i>
                </div>
                <div style="border-left:1.5pt solid black; padding-left:20px; width:40%; font-style:italic; display:flex; align-items:center;">
                    On Writ of Certiorari to the ${get('lowerCourt') || 'the Lower Court'}
                </div>
            </div>

            <div class="title-box">BRIEF FOR THE ${bType.toUpperCase()}</div>

            <div style="text-align:center; margin-top:1in;">
                <b>Respectfully Submitted,</b><br><br>
                <span class="sc-caps">${get('firmName')}</span><br>
                <div style="font-size:11pt; margin-top:10px;">${get('studentNames').replace(/\n/g, '<br>')}</div>
            </div>

            <div style="page-break-after: always;"></div>
            <div class="section-header">QUESTIONS PRESENTED</div>
            ${data.questions.map((q, i) => `<p style="text-indent:0.5in; margin-bottom:15px;"><b>${i+1}.</b> ${q}</p>`).join('')}

            <div style="page-break-after: always;"></div>
            <div class="section-header">TABLE OF AUTHORITIES</div>
            <p><b>Cases:</b></p>
            ${data.cases.filter(x=>x).sort().map(c => `<div style="padding-left:0.5in; text-indent:-0.2in; margin-bottom:5px;"><i>${c}</i></div>`).join('')}
            <p style="margin-top:20px;"><b>Statutes:</b></p>
            ${data.statutes.filter(x=>x).sort().map(s => `<div style="padding-left:0.5in; margin-bottom:5px;">${s}</div>`).join('')}

            ${bType === 'Amicus Curiae' ? `
                <div style="page-break-after: always;"></div>
                <div class="section-header">INTEREST OF AMICUS CURIAE</div>
                <p style="text-indent: 0.5in; white-space: pre-wrap;">${get('amicusInterest')}</p>
            ` : ''}

            <div style="page-break-after: always;"></div>
            <div class="section-header">SUMMARY OF ARGUMENT</div>
            <p style="text-indent: 0.5in;">${get('summaryArg')}</p>

            <div class="section-header">ARGUMENT</div>
            <p style="white-space: pre-wrap; text-indent: 0.5in;">${get('argBody')}</p>

            <div style="page-break-after: always;"></div>
            <div class="section-header">CONCLUSION</div>
            <p style="text-indent: 0.5in;">${get('conclusionText')}</p>
        `;
        document.getElementById('render-target').innerHTML = html;
    }

    // --- CLOUD MULTI-SAVE LOGIC ---
    function onSignIn(resp) {
        const payload = JSON.parse(atob(resp.credential.split('.')[1]));
        userKey = payload.sub;
        document.getElementById('auth-status').innerText = `Logged in: ${payload.email}`;
        document.getElementById('cloudBtn').style.display = 'block';
        document.getElementById('project-selector-zone').style.display = 'block';
        updateProjectDropdown();
    }

    function updateProjectDropdown() {
        const projects = JSON.parse(localStorage.getItem('briefs_' + userKey) || "{}");
        const select = document.getElementById('projectList');
        select.innerHTML = '<option value="">-- Select a Saved Brief --</option>';
        for (let title in projects) {
            const opt = document.createElement('option');
            opt.value = title; opt.innerText = title;
            select.appendChild(opt);
        }
    }

    function dbSave() {
        const title = document.getElementById('projectTitle').value;
        if(!title) return alert("Please enter a Project Title first.");
        
        const inputs = {};
        document.querySelectorAll('input, textarea, select').forEach(el => { if(el.id) inputs[el.id] = el.value; });
        
        const projects = JSON.parse(localStorage.getItem('briefs_' + userKey) || "{}");
        projects[title] = { data, inputs };
        localStorage.setItem('briefs_' + userKey, JSON.stringify(projects));
        
        alert("Project '" + title + "' saved to your account!");
        updateProjectDropdown();
    }

    function loadSelectedProject() {
        const title = document.getElementById('projectList').value;
        if(!title) return;
        const projects = JSON.parse(localStorage.getItem('briefs_' + userKey));
        const saved = projects[title];
        data = saved.data;
        for(let id in saved.inputs) { if(document.getElementById(id)) document.getElementById(id).value = saved.inputs[id]; }
        renderInputFields(); refresh();
    }

    // --- LOCAL LOGIC ---
    function localExport() {
        const title = document.getElementById('projectTitle').value || "brief";
        const inputs = {};
        document.querySelectorAll('input, textarea, select').forEach(el => { if(el.id) inputs[el.id] = el.value; });
        const blob = new Blob([JSON.stringify({ data, inputs })], {type: "application/json"});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = title + ".json";
        a.click();
    }

    function localImport(e) {
        const reader = new FileReader();
        reader.onload = (event) => {
            const pack = JSON.parse(event.target.result);
            data = pack.data;
            for(let id in pack.inputs) { if(document.getElementById(id)) document.getElementById(id).value = pack.inputs[id]; }
            renderInputFields(); refresh();
        };
        reader.readAsText(e.target.files[0]);
    }

    function downloadPDF() {
        html2pdf().from(document.getElementById('print-area')).set({
            margin: 0.5, filename: 'Brief.pdf',
            html2canvas: { scale: 3 }, jsPDF: { unit: 'in', format: 'letter' }
        }).save();
    }
</script>
</body>
</html>
